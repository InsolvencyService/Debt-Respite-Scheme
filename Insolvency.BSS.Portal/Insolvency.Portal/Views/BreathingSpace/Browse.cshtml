@using Insolvency.Common
@using Insolvency.Common.Enums
@model Insolvency.Portal.Models.ViewModels.BreathingSpaceBrowseViewModel
@{
    ViewData["Title"] = @Localizer["Breathing Space"];
}

@section navigation
{
<partial name="_HomeNavigation" model="@null" />
}
<div id="content">
    <form method="get">
        <div id="content-filter" class="govuk-grid-column-one-third">
            <fieldset class="govuk-fieldset">
                <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
                    <h2 class="govuk-heading-m">Filter by:</h2>
                </legend>
                <div class="govuk-radios--small">
                    <div class="govuk-radios__item">
                        <input class="govuk-radios__input"
                               onchange="this.form.submit();"
                               id="browse-by-category-active-breathing-spaces"
                               asp-for="BrowseByCategory"
                               type="radio"
                               value="@BreathingSpaceBrowseCategory.ActiveBreathingSpaces">
                        <label class="govuk-label govuk-radios__label app-no-box-shadow" for="browse-by-category-active-breathing-spaces">
                            @Localizer["Active Breathing Spaces"] (@Model.LandingPageModel.ActiveBreathingSpacesCount)
                        </label>
                    </div>
                    <div class="govuk-radios__item">
                        <input class="govuk-radios__input condition"
                               onchange="this.form.submit();"
                               id="browse-by-category-tasks-to-do"
                               asp-for="BrowseByCategory"
                               type="radio"
                               value="@BreathingSpaceBrowseCategory.TasksToDo">
                        <label class="govuk-label govuk-radios__label app-no-box-shadow" for="browse-by-category-tasks-to-do">
                            @Localizer["Tasks"] (@Model.LandingPageModel.TasksToDoCount) <strong class="govuk-tag govuk-tag--grey">TO DO</strong>
                        </label>
                        <div class="govuk-radios__conditional condition-body">
                            <div class="govuk-radios govuk-radios">
                                <div class="govuk-radios__item">
                                    <input class="govuk-radios__input"
                                           onchange="this.form.submit();"
                                           id="browse-by-task-tasks-debts-to-be-reviewed"
                                           asp-for="BrowseByTask"
                                           type="radio"
                                           value="@BreathingSpaceBrowseTask.DebtsToBeReviewed" />
                                    <label class="govuk-label govuk-radios__label app-no-box-shadow" for="browse-by-task-tasks-debts-to-be-reviewed">
                                        @Localizer["Debts to review"] (@Model.LandingPageModel.DebtReviewsCount)
                                    </label>
                                </div>
                                <div class="govuk-radios__item">
                                    <input class="govuk-radios__input"
                                           onchange="this.form.submit();"
                                           id="browse-by-task-tasks-clients-to-be-reviewed"
                                           asp-for="BrowseByTask"
                                           type="radio"
                                           value="@BreathingSpaceBrowseTask.ClientsToBeReviewed" />
                                    <label class="govuk-label govuk-radios__label app-no-box-shadow" for="browse-by-task-tasks-clients-to-be-reviewed">
                                        @Localizer["Clients to review"] (@Model.LandingPageModel.ClientReviewsCount)
                                    </label>
                                </div>
                                <div class="govuk-radios__item">
                                    <input class="govuk-radios__input"
                                           onchange="this.form.submit();"
                                           id="browse-by-task-tasks-new-debts-proposed"
                                           asp-for="BrowseByTask"
                                           type="radio"
                                           value="@BreathingSpaceBrowseTask.NewDebtsProposed" />
                                    <label class="govuk-label govuk-radios__label app-no-box-shadow" for="browse-by-task-tasks-new-debts-proposed">
                                        @Localizer["Proposed new debts"] (@Model.LandingPageModel.NewlyProposedDebtsCount)
                                    </label>
                                </div>
                                <div class="govuk-radios__item">
                                    <input class="govuk-radios__input"
                                           onchange="this.form.submit();"
                                           id="browse-by-task-tasks-debts-to-be-transferred"
                                           asp-for="BrowseByTask"
                                           type="radio"
                                           value="@BreathingSpaceBrowseTask.DebtsToBeTransferred" />
                                    <label class="govuk-label govuk-radios__label app-no-box-shadow" for="browse-by-task-tasks-debts-to-be-transferred">
                                        @Localizer["Sold debts to transfer"] (@Model.LandingPageModel.SoldDebtsTransfersCount)
                                    </label>
                                </div>
                                <div class="govuk-radios__item">
                                    <input class="govuk-radios__input"
                                           onchange="this.form.submit();"
                                           id="browse-by-task-tasks-clients-to-be-transferred"
                                           asp-for="BrowseByTask"
                                           type="radio"
                                           value="@BreathingSpaceBrowseTask.ClientsToBeTransferred" />
                                    <label class="govuk-label govuk-radios__label app-no-box-shadow" for="browse-by-task-tasks-clients-to-be-transferred">
                                        @Localizer["Clients to transfer"] (@Model.LandingPageModel.ClientTransferRequestsCount)
                                    </label>
                                </div>
                                <div class="govuk-radios__item">
                                    <input class="govuk-radios__input"
                                           onchange="this.form.submit();"
                                           id="browse-by-task-tasks-clients-transferred-to-money-adviser"
                                           asp-for="BrowseByTask"
                                           type="radio"
                                           value="@BreathingSpaceBrowseTask.ClientsTransferredToMoneyAdviser" />
                                    <label class="govuk-label govuk-radios__label app-no-box-shadow" for="browse-by-task-tasks-clients-transferred-to-money-adviser">
                                        @Localizer["Clients transferred to us"] (@Model.LandingPageModel.ClientTransfersMoneyAdviserCount)
                                    </label>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="govuk-radios__item">
                        <input class="govuk-radios__input"
                               onchange="this.form.submit();"
                               id="browse-by-category-sent-to-money-adviser"
                               asp-for="BrowseByCategory"
                               type="radio"
                               value="@BreathingSpaceBrowseCategory.SentToMoneyAdviser">
                        <label class="govuk-label govuk-radios__label app-no-box-shadow" for="browse-by-category-sent-to-money-adviser">
                            @Localizer["Sent to money adviser"] (@Model.LandingPageModel.SentToMoneyAdviserCount)
                        </label>
                    </div>
                </div>
            </fieldset>
            <noscript>
                <button id="filter-button" class="govuk-button govuk-!-margin-top-3" value="Filter" data-module="govuk-button" type="submit">
                    Filter
                </button>
            </noscript>

        </div>

        <div id="content-list" class="govuk-grid-column-two-thirds">
            <h1 class="govuk-heading-l">@Model.BrowseByCategory.GetDisplayName()</h1>
            <h2 class="govuk-heading-m">
                <span class="govuk-!-font-weight-regular">Showing: </span>@(Model.BrowseByTask.HasValue ? Model.BrowseByTask.GetDisplayName() : "All") (@Model.GetTotalItemsCount())
            </h2>

            @if (Model.BreathingSpaceBrowseItems.Count > 0)
            {
                <label class="govuk-label" for="sort">
                    Sort by
                </label>
                <select asp-for="ShowNewestFirst" class="govuk-select" id="sort">
                    <option value="true" selected>Newest</option>
                    <option value="false">Oldest</option>
                </select>
                <button id="sort-button" class="govuk-button govuk-button--secondary govuk-!-margin-bottom-0 govuk-!-margin-left-5" value="Sort" data-module="govuk-button" type="submit">
                    Sort
                </button>
                <ul class="govuk-list">
                    @{
                        int i = 0;
                        foreach (var item in Model.BreathingSpaceBrowseItems)
                        {
                            <li>
                                <div class="breathing-space-item app-border-panel govuk-!-padding-3 govuk-!-margin-top-4">
                                    <a id="@($"breathing-space-browse-result-{i}")"
                                        asp-controller="BreathingSpace"
                                        asp-action="AccountSearchNavigate"
                                        asp-route-moratoriumId="@item.BreathingSpaceId"
                                        asp-route-journeyKey="@Guid.NewGuid()"
                                        asp-route-parentJourneyKey="@ViewData["JourneyKey"].ToString()"
                                        class="govuk-link govuk-body govuk-!-font-weight-bold govuk-link--no-visited-state"
                                        role="link"
                                        aria-controls="back-link-example-html"
                                        data-track="tab-html"
                                        aria-expanded="false">
                                        <strong>
                                            <span class="govuk-visually-hidden">View details for </span>@item.FirstName @item.LastName
                                        </strong>
                                    </a>
                                    <hr class="govuk-section-break govuk-!-margin-top-3 govuk-!-margin-bottom-3 govuk-section-break--visible">
                                    @if (Model.IsTask)
                                    {
                                        <strong class="govuk-tag govuk-tag--grey">TO DO</strong>
                                    }
                                    <ul class="govuk-list govuk-!-margin-bottom-0 govuk-!-font-size-16">
                                        @if (Model.IsTask)
                                        {
                                            <li>Task: @Model.GetSelectedTaskDescription()</li>
                                        }
                                        <li>Reference: @item.BreathingSpaceReference</li>
                                        @if (item.HasStartDate)
                                        {
                                            <li>Date started: @item.FormattedActiveMoratoriumStartDate</li>
                                        }
                                        @if (item.HasEndDate)
                                        {
                                            <li>Date due to end: @item.FormattedActiveMoratoriumEndDate</li>
                                        }
                                    </ul>
                                </div>
                            </li>
                            i++;
                        }
                    }
                </ul>
            }
            @Html.Raw(Model.Pagination.PaginationHtml)
        </div>
    </form>
</div>
